---
import { getRelativeLocaleUrl } from 'astro:i18n';

import { SITE_TITLE, SITE_URL_MAP, I18N_DEFAULT_LOCALE } from '@/constants/config';
import Logo from '@/components/astro/logo';

import SocialFollowButton from './SocialFollowButton.astro';

interface Props {
  style?: string;
}

const { style } = Astro.props;
const today = new Date();
const getLocaleUrl = getRelativeLocaleUrl.bind(null, Astro.currentLocale || I18N_DEFAULT_LOCALE);

const footerLinks = [
  {
    title: '本地生活服务网络',
    links: [
      { text: '银湖大社区', href: SITE_URL_MAP.yinhuCommunitySpace, external: true },
      { text: '数字银湖', href: SITE_URL_MAP.digitalYinhuDoc, external: true },
    ],
  },
  {
    title: '组织',
    links: [
      { text: '关于银湖创联', href: SITE_URL_MAP.about, external: false },
      { text: '联系运营团队', href: SITE_URL_MAP.contact, external: true },
    ],
  },
];
---

<footer style={style} class="py-12 bg-gradient-to-b from-gray-50 to-gray-100 text-gray-600">
  <div class="max-w-screen-xl mx-auto px-4">
    {/* 上面部分：左右结构 */}
    <div class="flex flex-col md:flex-row justify-between items-start mb-12">
      {/* 左边：Logo、文案和SNS账号 */}
      <div class="mb-8 md:mb-0">
        <div class="flex items-center mb-6">
          <Logo class="!size-12 mr-3" />
          <div>
            <h2 class="mb-2 text-medium font-bold text-gray-700">{SITE_TITLE}</h2>
            <p class="mb-0 text-sm text-gray-400 leading-none">
              连接银湖在地的自由创造者
            </p>
          </div>
        </div>
        <div>
          <div class="flex space-x-3">
            <SocialFollowButton platform="wechat" />
            <SocialFollowButton platform="xiaohongshu" />
          </div>
        </div>
      </div>

      {/* 右侧：服务网络和组织 */}
      <div class="flex flex-col md:flex-row space-y-8 md:space-y-0 md:space-x-12">
        {footerLinks.map((section) => (
          <div>
            <h3 class="text-base font-normal text-gray-400 mb-3">{section.title}</h3>
            <div class="flex flex-col space-y-3 font-medium">
              {section.links.map((link) => (
                <a
                  href={link.external ? link.href : getLocaleUrl(link.href)}
                  target={link.external ? '_blank' : undefined}
                  rel={link.external ? 'external' : undefined}
                  class="text-sm text-gray-600 hover:text-blue-600 transition-colors"
                >
                  {link.text}
                </a>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>

    {/* 下面部分：版权信息 */}
    <div class="text-center pt-8 border-t border-gray-200">
      &copy; {today.getFullYear()} <a href={getLocaleUrl('/')}>{SITE_TITLE}</a> 保留所有权利 ❤️ 由 <a href="https://yinhufreedom.github.io" target="_blank" rel="external">银湖软件开发小组</a> 提供技术支持
    </div>
  </div>
</footer>

<!-- QR Code Modals -->
<div id="wechat-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
  <div class="absolute inset-0 bg-black/50" data-close="modal"></div>
  <div class="relative bg-white rounded-lg shadow-xl p-6 max-w-sm mx-4 transition-all duration-300" id="wechat-content">
    <button class="absolute top-4 right-4 text-gray-500 hover:text-gray-700" data-close="modal">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
    <div class="text-center">
      <h4 class="text-lg font-semibold mb-4">微信公众号</h4>
      <div class="bg-gray-100 p-4 rounded-lg mb-4">
        <img src="/images/common/qrcode-wechat.jpg" alt="微信公众号二维码" class="w-48 h-48 mx-auto" />
      </div>
      <p class="text-sm text-gray-600">扫码关注我们的微信公众号</p>
    </div>
  </div>
</div>

<div id="xiaohongshu-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
  <div class="absolute inset-0 bg-black/50" data-close="modal"></div>
  <div class="relative bg-white rounded-lg shadow-xl p-6 max-w-sm mx-4 transition-all duration-300" id="xiaohongshu-content">
    <button class="absolute top-4 right-4 text-gray-500 hover:text-gray-700" data-close="modal">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
    <div class="text-center">
      <h4 class="text-lg font-semibold mb-4">小红书</h4>
      <div class="bg-gray-100 p-4 rounded-lg mb-4">
        <img src="/images/common/qrcode-rednote.jpg" alt="小红书二维码" class="w-48 h-48 mx-auto" />
      </div>
      <p class="text-sm text-gray-600">扫码关注我们的小红书</p>
    </div>
  </div>
</div>

<script>
  function openQrCode(platform) {
    const modal = document.getElementById(`${platform}-modal`);
    const content = document.getElementById(`${platform}-content`);

    if (modal && content) {
      modal.classList.remove('hidden');
      // Trigger reflow for animation
      content.offsetHeight;
      content.classList.remove('scale-95', 'opacity-0');
      content.classList.add('scale-100', 'opacity-100');
    }
  }

  function closeQrCode() {
    const modals = ['wechat-modal', 'xiaohongshu-modal'];
    const contents = ['wechat-content', 'xiaohongshu-content'];

    modals.forEach((modalId, index) => {
      const modal = document.getElementById(modalId);
      const content = document.getElementById(contents[index]);

      if (modal && content) {
        content.classList.remove('scale-100', 'opacity-100');
        content.classList.add('scale-95', 'opacity-0');

        setTimeout(() => {
          modal.classList.add('hidden');
        }, 300);
      }
    });
  }

  // Add event listeners when DOM is loaded
  document.addEventListener('DOMContentLoaded', function() {
    // Add click event listeners to platform buttons
    const platformButtons = document.querySelectorAll('[data-platform]');
    platformButtons.forEach(button => {
      button.addEventListener('click', function() {
        const platform = this.getAttribute('data-platform');
        if (platform) {
          openQrCode(platform);
        }
      });
    });

    // Add click event listeners to close buttons
    const closeButtons = document.querySelectorAll('[data-close="modal"]');
    closeButtons.forEach(button => {
      button.addEventListener('click', closeQrCode);
    });
  });
</script>
