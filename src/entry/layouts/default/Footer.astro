---
import { getRelativeLocaleUrl } from 'astro:i18n';

import { SITE_TITLE, I18N_DEFAULT_LOCALE } from '@/constants/config';
import SocialFollowButton from './SocialFollowButton.astro';

interface Props {
  style?: string;
}

const { style } = Astro.props;
const today = new Date();
const getLocaleUrl = getRelativeLocaleUrl.bind(null, Astro.currentLocale || I18N_DEFAULT_LOCALE);
---

<footer style={style} class="py-12 px-4 bg-gradient-to-b from-gray-50 to-gray-100 text-gray-600 text-center">
  <div class="max-w-screen-xl mx-auto">
    <div class="mb-6">
      <h3 class="text-base font-medium text-gray-700 mb-3">关注我们</h3>
      <div class="flex space-x-4 justify-center">
        <SocialFollowButton
          platform="wechat"
          label="微信公众号"
        />
        <SocialFollowButton
          platform="xiaohongshu"
          label="小红书"
        />
      </div>
    </div>
    <div class="text-center">
      &copy; {today.getFullYear()} <a href={getLocaleUrl('/')}>{SITE_TITLE}</a> 保留所有权利 ❤️ 由 <a href="https://yinhufreedom.github.io" target="_blank" rel="external">银湖软件开发小组</a> 提供技术支持
    </div>
  </div>
</footer>

<!-- QR Code Modals -->
<div id="wechat-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
  <div class="absolute inset-0 bg-black/50" data-close="modal"></div>
  <div class="relative bg-white rounded-lg shadow-xl p-6 max-w-sm mx-4 transition-all duration-300" id="wechat-content">
    <button class="absolute top-4 right-4 text-gray-500 hover:text-gray-700" data-close="modal">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
    <div class="text-center">
      <h4 class="text-lg font-semibold mb-4">微信公众号</h4>
      <div class="bg-gray-100 p-4 rounded-lg mb-4">
        <img src="/images/common/qrcode-wechat.jpg" alt="微信公众号二维码" class="w-48 h-48 mx-auto" />
      </div>
      <p class="text-sm text-gray-600">扫码关注我们的微信公众号</p>
    </div>
  </div>
</div>

<div id="xiaohongshu-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
  <div class="absolute inset-0 bg-black/50" data-close="modal"></div>
  <div class="relative bg-white rounded-lg shadow-xl p-6 max-w-sm mx-4 transition-all duration-300" id="xiaohongshu-content">
    <button class="absolute top-4 right-4 text-gray-500 hover:text-gray-700" data-close="modal">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
    <div class="text-center">
      <h4 class="text-lg font-semibold mb-4">小红书</h4>
      <div class="bg-gray-100 p-4 rounded-lg mb-4">
        <img src="/images/common/qrcode-rednote.jpg" alt="小红书二维码" class="w-48 h-48 mx-auto" />
      </div>
      <p class="text-sm text-gray-600">扫码关注我们的小红书</p>
    </div>
  </div>
</div>

<script>
  function openQrCode(platform) {
    const modal = document.getElementById(`${platform}-modal`);
    const content = document.getElementById(`${platform}-content`);

    if (modal && content) {
      modal.classList.remove('hidden');
      // Trigger reflow for animation
      content.offsetHeight;
      content.classList.remove('scale-95', 'opacity-0');
      content.classList.add('scale-100', 'opacity-100');
    }
  }

  function closeQrCode() {
    const modals = ['wechat-modal', 'xiaohongshu-modal'];
    const contents = ['wechat-content', 'xiaohongshu-content'];

    modals.forEach((modalId, index) => {
      const modal = document.getElementById(modalId);
      const content = document.getElementById(contents[index]);

      if (modal && content) {
        content.classList.remove('scale-100', 'opacity-100');
        content.classList.add('scale-95', 'opacity-0');

        setTimeout(() => {
          modal.classList.add('hidden');
        }, 300);
      }
    });
  }

  // Add event listeners when DOM is loaded
  document.addEventListener('DOMContentLoaded', function() {
    // Add click event listeners to platform buttons
    const platformButtons = document.querySelectorAll('[data-platform]');
    platformButtons.forEach(button => {
      button.addEventListener('click', function() {
        const platform = this.getAttribute('data-platform');
        if (platform) {
          openQrCode(platform);
        }
      });
    });

    // Add click event listeners to close buttons
    const closeButtons = document.querySelectorAll('[data-close="modal"]');
    closeButtons.forEach(button => {
      button.addEventListener('click', closeQrCode);
    });
  });
</script>
